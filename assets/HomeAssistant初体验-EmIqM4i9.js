import{_ as n,c as k,a as l,b as i,e as t,w as e,d as s,r as F,o as d}from"./app-Co7vUIjN.js";const r="https://cdn.jsdmirror.com/gh/chzxxuanzheng/The-World-Of-Lee@pages/assets/add-ons-shop-mFrcnNLe.png",p="https://cdn.jsdmirror.com/gh/chzxxuanzheng/The-World-Of-Lee@pages/assets/editor-proxies-CaujfcRb.png",o="https://cdn.jsdmirror.com/gh/chzxxuanzheng/The-World-Of-Lee@pages/assets/web-terminal-setting-CMsA7iP1.png",g="https://cdn.jsdmirror.com/gh/chzxxuanzheng/The-World-Of-Lee@pages/assets/install-xiaomi-home-6zwnyykb.png",c="https://cdn.jsdmirror.com/gh/chzxxuanzheng/The-World-Of-Lee@pages/assets/flow-chart-CdxArhxY.png",y="https://cdn.jsdmirror.com/gh/chzxxuanzheng/The-World-Of-Lee@pages/assets/add-if-then-CxBCQF4s.png",B="https://cdn.jsdmirror.com/gh/chzxxuanzheng/The-World-Of-Lee@pages/assets/edit-yaml-CUg8yNvD.png",f="https://cdn.jsdmirror.com/gh/chzxxuanzheng/The-World-Of-Lee@pages/assets/send-notice-Dtd-GOHh.png",m={},A={class:"markdown-content"},D={class:"custom-block normally"},u={class:"custom-block normally"},b={class:"custom-block normally"},x={class:"custom-block normally"},E={class:"custom-block normally"},L={class:"custom-block normally"},_={class:"custom-block normally"},H={class:"custom-block normally"};function C(j,h){const a=F("code-block");return d(),k("div",A,[h[8]||(h[8]=l('<h2 id="h-物品清单" tabindex="-1"><a class="header-anchor" href="#物品清单"></a> 物品清单</h2><p>我主要是用来给自己的卧式里灯加个智能开关试试水。 经pxx和某宝多方对比，市场上流通的智能开关都是蓝牙Mesh2.0接入米家的。我自己是没搞明白怎么自己搭建蓝牙Mesh2.0网关，只能自己花钱买了。 最便宜的是二手小爱音响…我实属难以接受家里有个奇奇怪怪的ai语音识别音箱，就买了个<code>Yeelight</code>蓝牙网关，加个140左右。</p><p>智能开关买的是不知名小作坊做的，价格40左右一个，不便宜。</p><div class="tip custom-block"><p class="custom-block-title">提示</p><p>买之前先看下你家的灯是不是串联在零线上的。如果是的话，需要购买不要零线的版本，否则会无法使用。要零线的版本是和灯串联在一起的，会导致开关和灯的电压均不足无法正常工作。 <s>我先图便宜买了个要零线的版本，回家接上去发现不好用才想起来家里零线上还串联了一个灯…</s></p></div><h2 id="h-HomeAssistant安装" tabindex="-1"><a class="header-anchor" href="#HomeAssistant安装"></a> HomeAssistant安装</h2><p>先按照<a href="https://www.home-assistant.io/installation/">官网</a>说的装下。我装的是<code>HA OS</code>，直接扔到PVE的虚拟机里就完事了。注意需要开启<code>UEFI</code>引导，同时第一次启动时需要科学上网。</p><h3 id="h-配置nginx" tabindex="-1"><a class="header-anchor" href="#配置nginx"></a> 配置nginx</h3><p>ha默认是不接受反代的，需要自己修改配置文件把反代地址加入到可信名单里。要修改ha的配置文件首先需要安装<code>File editor</code>。点击左下角的<code>设置</code>→<code>加载项</code>→<code>加载项商店</code>，搜索就可以找到安装。</p><p><img src="'+r+'" alt="加载项商店"></p><p>安装后，打开它就能看到<code>config</code>文件夹，找到<code>configuration.yaml</code>文件，添加以下内容</p>',10)),i("div",D,[t(a,{info:{content:{},lang:"YAML",name:"YAML",needLineNumbers:!1,startLine:1,groupId:0,lineCount:4}},{default:e(()=>[...h[0]||(h[0]=[i("pre",{class:"shiki shiki-themes min-light min-dark",style:{"--shiki-light":"#24292eff","--shiki-dark":"#b392f0","--shiki-light-bg":"#ffffff","--shiki-dark-bg":"#1f1f1f"},tabindex:"0"},[i("code",null,[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F8F8F8"}},"http"),i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F97583"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F8F8F8"}},"  use_x_forwarded_for"),i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F97583"}},":"),i("span",{style:{"--shiki-light":"#1976D2","--shiki-dark":"#79B8FF"}}," true")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F8F8F8"}},"  trusted_proxies"),i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F97583"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292EFF","--shiki-dark":"#B392F0"}},"    - "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#FFAB70"}},"192.168.1.x"),i("span",{style:{"--shiki-light":"#C2C3C5","--shiki-dark":"#6B737C"}},"  # 你的反代服务器地址")]),s(`
`),i("span",{class:"line"})])],-1)])]),_:1})]),h[9]||(h[9]=l('<p>添加完记得保存，之后是这样的：</p><p><img src="'+p+'" alt="修改后的configuration.yaml"></p><h3 id="h-安装Web终端" tabindex="-1"><a class="header-anchor" href="#安装Web终端"></a> 安装Web终端</h3><p>和<a href="#%E9%85%8D%E7%BD%AEnginx">安装<code>File editor</code></a>类似，去加载项安装<code>Advanced SSH &amp; Web Terminal</code>。但要注意的是需要先去<code>配置</code>里编写一个用户和密码才可以使用。</p><p><img src="'+o+'" alt="Advanced SSH &amp; Web Terminal配置"></p><h2 id="h-连接智能设备" tabindex="-1"><a class="header-anchor" href="#连接智能设备"></a> 连接智能设备</h2><p>首先给你的智能设备接入米家，这里不再赘述。接入后再通过一些插件可以接入HomeAssistant来进行控制。</p><h3 id="h-小米插件" tabindex="-1"><a class="header-anchor" href="#小米插件"></a> 小米插件</h3><p>小米官方是对HomeAssistant提供了官方插件，但是需要在<code>HACS</code>上安装。你可以去<a href="https://hacs.xyz/docs/use/">HACS的官网</a>看如何安装，写的是比较详细的。 装完后去HACS栏安装<code>Xiaomi Home</code>插件就行了。</p><p><img src="'+g+'" alt="小米插件"></p><p>安装完后按照它说的授权就行了。要是授权完跳转到<code>homeassistant.local</code>之类的域名问题不大，给前面的域名改成你自己的域名就行了。 接着跟着它的指导，它会自动把所有设备都接入到HomeAssistant里。</p><h2 id="h-控制智能设备" tabindex="-1"><a class="header-anchor" href="#控制智能设备"></a> 控制智能设备</h2><p>你可以在<code>设置</code>→<code>自动化与场景</code>里来创建控制逻辑。HomeAssistant支持通过Python来控制流程逻辑，功能非常强大。这里以我的WebHook控制智能开关为例。</p><p>HomeAssistant的开关有三种操作：<code>打开</code>，<code>关闭</code>，<code>切换开关</code>。 我的预期的行为逻辑是向HomeAssistant发送一个WebHook请求，如果包含一个<code>action</code>的参数，则按照指定操作执行，如果参数非法发通知，否则就<code>切换开关</code>。</p><p><img src="'+c+'" alt="自动化流程图"></p><h3 id="h-创建Token" tabindex="-1"><a class="header-anchor" href="#创建Token"></a> 创建Token</h3><p>想要WebHook能被外部程序控制，需要创建一个长期token才可以。点击左下角的<code>用户头像</code>，<code>安全</code>分栏，在最下面的<code>长期令牌</code>里创建一个新的token，记得保存好。 你可以通过下面代码测试你的token是否有效。笔者收到的响应是<code>404: Not Found</code>。只要不是<code>401: Unauthorized</code>就说明token是有效的。</p>',17)),i("div",u,[t(a,{info:{content:{},lang:"Python",name:"Python",needLineNumbers:!1,startLine:1,groupId:0,lineCount:10}},{default:e(()=>[...h[1]||(h[1]=[i("pre",{class:"shiki shiki-themes min-light min-dark",style:{"--shiki-light":"#24292eff","--shiki-dark":"#b392f0","--shiki-light-bg":"#ffffff","--shiki-dark-bg":"#1f1f1f"},tabindex:"0"},[i("code",null,[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292EFF","--shiki-dark":"#B392F0"}},"token "),i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#FFAB70"}}," '你自己创建的token'")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F97583"}},"import"),i("span",{style:{"--shiki-light":"#24292EFF","--shiki-dark":"#B392F0"}}," requests")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292EFF","--shiki-dark":"#B392F0"}},"url "),i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#FFAB70"}},' "https://你的域名/api/error/all"')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292EFF","--shiki-dark":"#B392F0"}},"headers "),i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#212121","--shiki-dark":"#BBBBBB"}}," "),i("span",{style:{"--shiki-light":"#0431FA","--shiki-dark":"#FFD700"}},"{")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#FFAB70"}},'    "Authorization"'),i("span",{style:{"--shiki-light":"#212121","--shiki-dark":"#BBBBBB"}},":"),i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F97583"}}," f"),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#FFAB70"}},'"Bearer '),i("span",{style:{"--shiki-light":"#319331","--shiki-dark":"#DA70D6"}},"{"),i("span",{style:{"--shiki-light":"#24292EFF","--shiki-dark":"#B392F0"}},"token"),i("span",{style:{"--shiki-light":"#319331","--shiki-dark":"#DA70D6"}},"}"),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#FFAB70"}},'"'),i("span",{style:{"--shiki-light":"#212121","--shiki-dark":"#BBBBBB"}},",")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#0431FA","--shiki-dark":"#FFD700"}},"}")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292EFF","--shiki-dark":"#B392F0"}},"response "),i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292EFF","--shiki-dark":"#B392F0"}}," requests"),i("span",{style:{"--shiki-light":"#212121","--shiki-dark":"#BBBBBB"}},"."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"request"),i("span",{style:{"--shiki-light":"#0431FA","--shiki-dark":"#FFD700"}},"("),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#FFAB70"}},'"GET"'),i("span",{style:{"--shiki-light":"#212121","--shiki-dark":"#BBBBBB"}},", url, headers"),i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#212121","--shiki-dark":"#BBBBBB"}},"headers"),i("span",{style:{"--shiki-light":"#0431FA","--shiki-dark":"#FFD700"}},")")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"print"),i("span",{style:{"--shiki-light":"#0431FA","--shiki-dark":"#FFD700"}},"("),i("span",{style:{"--shiki-light":"#212121","--shiki-dark":"#BBBBBB"}},"response.text"),i("span",{style:{"--shiki-light":"#0431FA","--shiki-dark":"#FFD700"}},")")]),s(`
`),i("span",{class:"line"})])],-1)])]),_:1})]),h[10]||(h[10]=i("h3",{id:"h-创建自动化",tabindex:"-1"},[i("a",{class:"header-anchor",href:"#创建自动化"}),s(" 创建自动化")],-1)),h[11]||(h[11]=i("h4",{id:"h-创建WebHook触发器",tabindex:"-1"},[i("a",{class:"header-anchor",href:"#创建WebHook触发器"}),s(" 创建WebHook触发器")],-1)),h[12]||(h[12]=i("p",null,[s("创建一个新的自动化，触发器选择"),i("code",null,"WebHook"),s("，触发器ID可以自定义，我用的是"),i("code",null,"bedroom-light-switch"),s("。 之后可以通过"),i("code",null,"https://你的域名/api/webhook/bedroom-light-switch"),s("来触发这个自动化。")],-1)),h[13]||(h[13]=i("p",null,"之后可以通过下面代码来测试触发器是否正常工作",-1)),i("div",b,[t(a,{info:{content:{},lang:"Python",name:"Python",needLineNumbers:!1,startLine:1,groupId:0,lineCount:11}},{default:e(()=>[...h[2]||(h[2]=[i("pre",{class:"shiki shiki-themes min-light min-dark",style:{"--shiki-light":"#24292eff","--shiki-dark":"#b392f0","--shiki-light-bg":"#ffffff","--shiki-dark-bg":"#1f1f1f"},tabindex:"0"},[i("code",null,[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292EFF","--shiki-dark":"#B392F0"}},"token "),i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#FFAB70"}}," '你自己创建的token'")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F97583"}},"import"),i("span",{style:{"--shiki-light":"#24292EFF","--shiki-dark":"#B392F0"}}," requests")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292EFF","--shiki-dark":"#B392F0"}},"url "),i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#FFAB70"}},' "https://你的域名/api/webhook/bedroom-light-switch"')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292EFF","--shiki-dark":"#B392F0"}},"headers "),i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#212121","--shiki-dark":"#BBBBBB"}}," "),i("span",{style:{"--shiki-light":"#0431FA","--shiki-dark":"#FFD700"}},"{")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#FFAB70"}},'    "Authorization"'),i("span",{style:{"--shiki-light":"#212121","--shiki-dark":"#BBBBBB"}},":"),i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F97583"}}," f"),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#FFAB70"}},'"Bearer '),i("span",{style:{"--shiki-light":"#319331","--shiki-dark":"#DA70D6"}},"{"),i("span",{style:{"--shiki-light":"#24292EFF","--shiki-dark":"#B392F0"}},"token"),i("span",{style:{"--shiki-light":"#319331","--shiki-dark":"#DA70D6"}},"}"),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#FFAB70"}},'"'),i("span",{style:{"--shiki-light":"#212121","--shiki-dark":"#BBBBBB"}},",")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#0431FA","--shiki-dark":"#FFD700"}},"}")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292EFF","--shiki-dark":"#B392F0"}},"data "),i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#212121","--shiki-dark":"#BBBBBB"}}," "),i("span",{style:{"--shiki-light":"#0431FA","--shiki-dark":"#FFD700"}},"{")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#FFAB70"}},"    'action'"),i("span",{style:{"--shiki-light":"#212121","--shiki-dark":"#BBBBBB"}},":"),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#FFAB70"}}," 'asd'")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#0431FA","--shiki-dark":"#FFD700"}},"}")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292EFF","--shiki-dark":"#B392F0"}},"response "),i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292EFF","--shiki-dark":"#B392F0"}}," requests"),i("span",{style:{"--shiki-light":"#212121","--shiki-dark":"#BBBBBB"}},"."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"post"),i("span",{style:{"--shiki-light":"#0431FA","--shiki-dark":"#FFD700"}},"("),i("span",{style:{"--shiki-light":"#212121","--shiki-dark":"#BBBBBB"}},"url, headers"),i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#212121","--shiki-dark":"#BBBBBB"}},"headers, json"),i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#212121","--shiki-dark":"#BBBBBB"}},"data"),i("span",{style:{"--shiki-light":"#0431FA","--shiki-dark":"#FFD700"}},")")]),s(`
`),i("span",{class:"line"})])],-1)])]),_:1})]),h[14]||(h[14]=i("p",null,[s("之后你会在自动化的执行记录里看到刚刚的触发记录。从中可以看到，我们传入的参数在"),i("code",null,"trigger.json"),s("里。")],-1)),i("div",x,[t(a,{info:{content:{},lang:"YAML",name:"YAML",needLineNumbers:!1,startLine:1,groupId:0,lineCount:14}},{default:e(()=>[...h[3]||(h[3]=[i("pre",{class:"shiki shiki-themes min-light min-dark",style:{"--shiki-light":"#24292eff","--shiki-dark":"#b392f0","--shiki-light-bg":"#ffffff","--shiki-dark-bg":"#1f1f1f"},tabindex:"0"},[i("code",null,[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F8F8F8"}},"variables"),i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F97583"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F8F8F8"}},"  trigger"),i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F97583"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F8F8F8"}},"    platform"),i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F97583"}},":"),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#FFAB70"}}," webhook")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F8F8F8"}},"    webhook_id"),i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F97583"}},":"),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#FFAB70"}}," bedroom-light-switch")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F8F8F8"}},"    json"),i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F97583"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F8F8F8"}},"      action"),i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F97583"}},":"),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#FFAB70"}}," asd")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F8F8F8"}},"    query"),i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F97583"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F8F8F8"}},"      __type"),i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F97583"}},":"),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#FFAB70"}}," <class 'multidict._multidict.MultiDictProxy'>")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F8F8F8"}},"      repr"),i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F97583"}},":"),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#FFAB70"}}," <MultiDictProxy()>")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F8F8F8"}},"    description"),i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F97583"}},":"),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#FFAB70"}}," webhook")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F8F8F8"}},"    id"),i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F97583"}},":"),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#FFAB70"}},' "0"')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F8F8F8"}},"    idx"),i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F97583"}},":"),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#FFAB70"}},' "0"')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F8F8F8"}},"    alias"),i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F97583"}},":"),i("span",{style:{"--shiki-light":"#1976D2","--shiki-dark":"#79B8FF"}}," null")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F8F8F8"}},"context"),i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F97583"}},":"),i("span",{style:{"--shiki-light":"#1976D2","--shiki-dark":"#79B8FF"}}," null")]),s(`
`),i("span",{class:"line"})])],-1)])]),_:1})]),h[15]||(h[15]=l('<h4 id="h-添加条件判断" tabindex="-1"><a class="header-anchor" href="#添加条件判断"></a> 添加条件判断</h4><p><code>且如果</code>是从全局判断该自动化能否执行，我们用不上。在<code>就执行</code>里添加一个<code>如果-就</code>分支。它是在区块分栏里。<s>近视眼笔者硬是手写yml都写完了，才发现有这个东西…</s></p><p><img src="'+y+'" alt="添加如果-就分支"></p><p>条件选择<code>模板</code>，内容如下：</p>',4)),i("div",E,[t(a,{info:{content:{},lang:"Jinja",name:"Jinja",needLineNumbers:!1,startLine:1,groupId:0,lineCount:1}},{default:e(()=>[...h[4]||(h[4]=[i("pre",{class:"shiki shiki-themes min-light min-dark",style:{"--shiki-light":"#24292eff","--shiki-dark":"#b392f0","--shiki-light-bg":"#ffffff","--shiki-dark-bg":"#1f1f1f"},tabindex:"0"},[i("code",null,[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#0431FA","--shiki-dark":"#FFD700"}},"{{"),i("span",{style:{"--shiki-light":"#24292EFF","--shiki-dark":"#B392F0"}}," trigger.get"),i("span",{style:{"--shiki-light":"#319331","--shiki-dark":"#DA70D6"}},"("),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#FFAB70"}},"'json'"),i("span",{style:{"--shiki-light":"#319331","--shiki-dark":"#DA70D6"}},")"),i("span",{style:{"--shiki-light":"#24292EFF","--shiki-dark":"#B392F0"}}," "),i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F97583"}},"!="),i("span",{style:{"--shiki-light":"#24292EFF","--shiki-dark":"#B392F0"}}," None "),i("span",{style:{"--shiki-light":"#0431FA","--shiki-dark":"#FFD700"}},"}}")]),s(`
`),i("span",{class:"line"})])],-1)])]),_:1})]),h[16]||(h[16]=l("<p>HomeAssistant的模板语法是基于Jinja2的，<code>{{}}</code>里面可以跑python参数，<code>trigger</code>是一个字典，直接get取值判断是否存在<code>json</code>参数。 <code>切换开关</code>在<code>动作</code>→<code>开关</code>里有，这里不细讲了。</p><p>下一个判断也是如法炮制，<code>模板</code>内容如下：</p>",2)),i("div",L,[t(a,{info:{content:{},lang:"Jinja",name:"Jinja",needLineNumbers:!1,startLine:1,groupId:0,lineCount:1}},{default:e(()=>[...h[5]||(h[5]=[i("pre",{class:"shiki shiki-themes min-light min-dark",style:{"--shiki-light":"#24292eff","--shiki-dark":"#b392f0","--shiki-light-bg":"#ffffff","--shiki-dark-bg":"#1f1f1f"},tabindex:"0"},[i("code",null,[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#0431FA","--shiki-dark":"#FFD700"}},"{{"),i("span",{style:{"--shiki-light":"#24292EFF","--shiki-dark":"#B392F0"}}," trigger.json.get"),i("span",{style:{"--shiki-light":"#319331","--shiki-dark":"#DA70D6"}},"("),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#FFAB70"}},"'action'"),i("span",{style:{"--shiki-light":"#319331","--shiki-dark":"#DA70D6"}},")"),i("span",{style:{"--shiki-light":"#24292EFF","--shiki-dark":"#B392F0"}}," "),i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F97583"}},"in"),i("span",{style:{"--shiki-light":"#24292EFF","--shiki-dark":"#B392F0"}}," "),i("span",{style:{"--shiki-light":"#319331","--shiki-dark":"#DA70D6"}},"["),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#FFAB70"}},"'turn_on'"),i("span",{style:{"--shiki-light":"#24292EFF","--shiki-dark":"#B392F0"}},", "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#FFAB70"}},"'turn_off'"),i("span",{style:{"--shiki-light":"#24292EFF","--shiki-dark":"#B392F0"}},", "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#FFAB70"}},"'toggle'"),i("span",{style:{"--shiki-light":"#319331","--shiki-dark":"#DA70D6"}},"]"),i("span",{style:{"--shiki-light":"#24292EFF","--shiki-dark":"#B392F0"}}," "),i("span",{style:{"--shiki-light":"#0431FA","--shiki-dark":"#FFD700"}},"}}")]),s(`
`),i("span",{class:"line"})])],-1)])]),_:1})]),h[17]||(h[17]=l('<p>具体为啥是<code>turn_on</code>，<code>turn_off</code>，<code>toggle</code>这三个参数，是因为HomeAssistant的开关动作就是这三个，笔者理解是枚举。</p><h4 id="h-执行自定义命令" tabindex="-1"><a class="header-anchor" href="#执行自定义命令"></a> 执行自定义命令</h4><p>我们要根据传进来的<code>action</code>参数来决定具体执行什么指令。这时候图形化就不好用了，我们都不知道要执行什么指令，怎么做图形化里选择？ 对整个流程选择<code>YAML编辑</code>，就可以自己自定义了。</p><p><img src="'+B+'" alt="YAML编辑"></p><p>在最下面的if，我们可以发现之前添加到切换开关指令是长这个样子的</p>',5)),i("div",_,[t(a,{info:{content:{},lang:"YAML",name:"YAML",needLineNumbers:!1,startLine:1,groupId:0,lineCount:5}},{default:e(()=>[...h[6]||(h[6]=[i("pre",{class:"shiki shiki-themes min-light min-dark",style:{"--shiki-light":"#24292eff","--shiki-dark":"#b392f0","--shiki-light-bg":"#ffffff","--shiki-dark-bg":"#1f1f1f"},tabindex:"0"},[i("code",null,[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292EFF","--shiki-dark":"#B392F0"}},"      - "),i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F8F8F8"}},"action"),i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F97583"}},":"),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#FFAB70"}}," switch.toggle")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F8F8F8"}},"        metadata"),i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F97583"}},":"),i("span",{style:{"--shiki-light":"#24292EFF","--shiki-dark":"#B392F0"}}," "),i("span",{style:{"--shiki-light":"#0431FA","--shiki-dark":"#FFD700"}},"{"),i("span",{style:{"--shiki-light":"#0431FA","--shiki-dark":"#FFD700"}},"}")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F8F8F8"}},"        target"),i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F97583"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F8F8F8"}},"          entity_id"),i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F97583"}},":"),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#FFAB70"}}," 你的设备编号")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F8F8F8"}},"        data"),i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F97583"}},":"),i("span",{style:{"--shiki-light":"#24292EFF","--shiki-dark":"#B392F0"}}," "),i("span",{style:{"--shiki-light":"#0431FA","--shiki-dark":"#FFD700"}},"{"),i("span",{style:{"--shiki-light":"#0431FA","--shiki-dark":"#FFD700"}},"}")]),s(`
`),i("span",{class:"line"})])],-1)])]),_:1})]),h[18]||(h[18]=i("p",null,[s("我们如法炮制把它复制到第二个if的里，但把switch.toggle改成"),i("code",null,"switch.{{ trigger.json.action }}"),s("。这样它就可以根据传进来的参数来决定执行什么操作了。")],-1)),i("div",H,[t(a,{info:{content:{},lang:"YAML",name:"YAML",needLineNumbers:!1,startLine:1,groupId:0,lineCount:5}},{default:e(()=>[...h[7]||(h[7]=[i("pre",{class:"shiki shiki-themes min-light min-dark",style:{"--shiki-light":"#24292eff","--shiki-dark":"#b392f0","--shiki-light-bg":"#ffffff","--shiki-dark-bg":"#1f1f1f"},tabindex:"0"},[i("code",null,[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292EFF","--shiki-dark":"#B392F0"}},"          - "),i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F8F8F8"}},"action"),i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F97583"}},":"),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#FFAB70"}}," switch.{{ trigger.json.action }}")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F8F8F8"}},"            metadata"),i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F97583"}},":"),i("span",{style:{"--shiki-light":"#24292EFF","--shiki-dark":"#B392F0"}}," "),i("span",{style:{"--shiki-light":"#0431FA","--shiki-dark":"#FFD700"}},"{"),i("span",{style:{"--shiki-light":"#0431FA","--shiki-dark":"#FFD700"}},"}")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F8F8F8"}},"            target"),i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F97583"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F8F8F8"}},"              entity_id"),i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F97583"}},":"),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#FFAB70"}}," 你的设备编号")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F8F8F8"}},"            data"),i("span",{style:{"--shiki-light":"#D32F2F","--shiki-dark":"#F97583"}},":"),i("span",{style:{"--shiki-light":"#24292EFF","--shiki-dark":"#B392F0"}}," "),i("span",{style:{"--shiki-light":"#0431FA","--shiki-dark":"#FFD700"}},"{"),i("span",{style:{"--shiki-light":"#0431FA","--shiki-dark":"#FFD700"}},"}")]),s(`
`),i("span",{class:"line"})])],-1)])]),_:1})]),h[19]||(h[19]=l('<h4 id="h-发送通知" tabindex="-1"><a class="header-anchor" href="#发送通知"></a> 发送通知</h4><p>发送通知选项有很多，大部分都是发送给设备，类似事件一样的东西。笔者也是翻了一会才找到发给用户看的通知。</p><p><img src="'+f+'" alt="发送通知"></p><p>这个也支持jinja模板渲染。这个没啥含金量，不细说了。</p><h4 id="h-调试" tabindex="-1"><a class="header-anchor" href="#调试"></a> 调试</h4><p>遇到问题可以点右上角<code>追踪</code>，它能输出很详细的过程。</p><h2 id="h-结语" tabindex="-1"><a class="header-anchor" href="#结语"></a> 结语</h2><p>HomeAssistant是笔者接触到的第一个智能家居平台。模板渲染可以调用Python让它有了一定的可玩性，WebHook的支持也让它扩展性很强。 但它的模板语法写起来真的很繁琐，效率低下，要是可以直接跑Python就好了。 同时目前如何让这个家伙科学上网我也没研究明白，之前都是要装东西时让软路由开下系统代理。</p><hr><p>amazing，我竟然写了篇200行的文章…这是我写的第一篇长文章吧，不知不觉中写了2h，希望对大家有帮助～</p>',10))])}const z=n(m,[["render",C]]);export{z as default};
